#!/usr/bin/env python
import csv
import json
import sys
import argparse


def zipmap(header, rows):
    indexes = {idx: h for idx, h in enumerate(header)}
    return [
        {indexes[i]: v for i, v in enumerate(row)}
        for row in rows
    ]


def load_csv(fp):
    contents = fp.read().splitlines()
    header, *rows = list(csv.reader(contents))
    return zipmap(header, rows)


def handle(fp, args):
    res = load_csv(fp)
    print(json.dumps(res, indent=(2 if args.pretty else None)))


def main(raw_args):
    parser = argparse.ArgumentParser("csv2json")
    parser.add_argument("file", nargs="?")
    parser.add_argument("--pretty", action="store_true")
    args = parser.parse_args(raw_args)
    if args.file:
        with open(args.file) as fp:
            handle(fp, args)
    else:
        handle(sys.stdin, args)


if __name__ == "__main__":
    main(sys.argv[1:])
